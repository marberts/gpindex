<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Decomposing price indexes • gpindex</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="decomposing-indexes_files/libs/quarto-html/popper.min.js"></script><script src="decomposing-indexes_files/libs/quarto-html/tippy.umd.min.js"></script><link href="decomposing-indexes_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="decomposing-indexes_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Decomposing price indexes">
<meta property="og:image" content="https://marberts.github.io/gpindex/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gpindex</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.2.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/gpindex.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/decomposing-indexes.html">Decomposing price indexes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/marberts/gpindex/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Decomposing price indexes</h1>




      <small class="dont-index">Source: <a href="https://github.com/marberts/gpindex/blob/main/vignettes/decomposing-indexes.qmd" class="external-link"><code>vignettes/decomposing-indexes.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <p><em>This vignette presents an extended version of <span class="citation" data-cites="martin2021">Martin (<a href="#ref-martin2021" role="doc-biblioref">2021</a>)</span>, and shows how to use the tools in this package to make these decompositions.</em></p>
<p>It is often useful to be able to decompose a price index into an additive or multiplicative form to evaluate how each input to the index affects its value. Following <span class="citation" data-cites="balk2008">Balk (<a href="#ref-balk2008" role="doc-biblioref">2008</a>)</span>, a price index is said to admit an additive decomposition if there exist weights that allow it to be represented as an arithmetic mean of price relatives, and is said to admit a multiplicative decomposition if there are weights that allow it to be represented as a geometric mean. Switching prices for quantities gives the analogous statements for a quantity index, and nothing is lost by focusing on price indexes.</p>
<p>There are several well-known decompositions for the most common types of bilateral price indexes. <span class="citation" data-cites="balk2008">Balk (<a href="#ref-balk2008" role="doc-biblioref">2008</a>, equation 4.13)</span> gives an additive decomposition for any index based on the geometric mean by transmuting the weights in the geometric mean with the logarithmic mean. This is the same decomposition derived by <span class="citation" data-cites="reinsdorf2002">Reinsdorf, Diewert, and Ehemann (<a href="#ref-reinsdorf2002" role="doc-biblioref">2002</a>, equation 20)</span> for the Törnqvist index. A similar approach yields a multiplicative decomposition for any index based on the arithmetic mean, again using the logarithmic mean <span class="citation" data-cites="balk2008">(<a href="#ref-balk2008" role="doc-biblioref">Balk 2008</a>, equation 4.8)</span>. Combining these results gives additive and multiplicative decompositions for the Fisher index <span class="citation" data-cites="reinsdorf2002">(<a href="#ref-reinsdorf2002" role="doc-biblioref">Reinsdorf, Diewert, and Ehemann 2002, sec. 6</a>)</span>. The van IJzeren additive decomposition for the Fisher index <span class="citation" data-cites="balk2008">(<a href="#ref-balk2008" role="doc-biblioref">Balk 2008</a>, equation 4.18)</span> is an alternative that does not explicitly use the logarithmic mean. Each of these decompositions results in weights that are positive and sum to one, as required to represent an index as an arithmetic or geometric mean.<a class="footnote-ref" role="doc-noteref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;There are decompositions with “weights” that do not sum to one, such as those for the Fisher index by &lt;span class="citation" data-cites="reinsdorf2002"&gt;Reinsdorf, Diewert, and Ehemann (&lt;a href="#ref-reinsdorf2002" role="doc-biblioref"&gt;2002, sec. 2&lt;/a&gt;)&lt;/span&gt; and &lt;span class="citation" data-cites="hallerbach2005"&gt;Hallerbach (&lt;a href="#ref-hallerbach2005" role="doc-biblioref"&gt;2005&lt;/a&gt;)&lt;/span&gt;, and for other superlative indexes by &lt;span class="citation" data-cites="diewert2002"&gt;Diewert (&lt;a href="#ref-diewert2002" role="doc-biblioref"&gt;2002&lt;/a&gt;)&lt;/span&gt;. &lt;span class="citation" data-cites="balk2008"&gt;Balk (&lt;a href="#ref-balk2008" role="doc-biblioref"&gt;2008&lt;/a&gt;, equation 4.28)&lt;/span&gt; gives the original multiplicative decomposition of the Fisher index, due to Vartia, for which the weights also do not sum to one. &lt;span class="citation" data-cites="webster2019"&gt;Webster and Tarnow-Mordi (&lt;a href="#ref-webster2019" role="doc-biblioref"&gt;2019&lt;/a&gt;)&lt;/span&gt; consider several decompositions for multilateral indexes, although again the “weights” do not sum to 1.&lt;/p&gt;'><sup>1</sup></a></p>
<p>I show how the additive and multiplicative decompositions for geometric, arithmetic, and Fisher indexes that use the logarithmic mean can be consolidated and made more general by switching out the logarithmic mean for the more general extended mean. The main result is a function that transmutes the weights in a generalized mean of a given order so that it can be represented as a generalized mean of any other order. This covers additive and multiplicative decompositions for indexes that do not belong to the arithmetic or geometric families, like harmonic indexes or the Lloyd-Moulton index, and allows both additive and multiplicative decompositions to be covered by a single equation, rather than treating them as different cases. Expressing a generalized index as a generalized mean of any other order also allows for the decomposition of indexes that are nested generalized means, like the family of superlative quadratic mean indexes that includes the Fisher index or the AG mean index by <span class="citation" data-cites="lent2009">Lent and Dorfman (<a href="#ref-lent2009" role="doc-biblioref">2009</a>)</span>. I demonstrate some useful properties of this general decomposition and show how it can be used to decompose indexes based on other types on means and decompose deflating a change in aggregate values with a price index. Throughout I show how the tools in the <em>gpindex</em> package can be used to decompose a price index.</p>
<section class="level2"><h2 id="sec-decompose">Decomposing generalized-mean indexes<a class="anchor" aria-label="anchor" href="#sec-decompose"></a>
</h2>
<p>A natural extension to the decompositions for indexes based on the arithmetic and geometric means is to derive weights that transform an index based on a generalized mean of order <span class="math inline">\(\rho\)</span> into one based on a generalized mean of order <span class="math inline">\(\varsigma\)</span>. To fix notation, let <span class="math inline">\(\mathbf{r} = (r_{1}, r_{2}, \ldots, r_{n}) \in \mathbb{R}^{n}_{++}\)</span> be a vector of price relatives for <span class="math inline">\(n\geq2\)</span> products and let <span class="math inline">\(\mathbf{w} = (w_{1}, w_{2}, \ldots, w_{n}) \in \Delta^{n - 1}\)</span> be the corresponding weights, where <span class="math inline">\(\Delta^{n - 1} = \{\mathbf{w} \in \mathbb{R}_{+}^{n} | \sum_{i = 1}^{n} w_{i} = 1\}\)</span> is the unit simplex. The goal is to find a vector-valued function <span class="math display">\[
\mathbf{v}(\mathbf{r}, \mathbf{w}; \rho, \varsigma) = (v_{1}(\mathbf{r}, \mathbf{w}; \rho, \varsigma), v_{2}(\mathbf{r}, \mathbf{w}; \rho, \varsigma),\ldots, v_{n}(\mathbf{r}, \mathbf{w}; \rho, \varsigma))
\]</span> mapping into <span class="math inline">\(\Delta^{n - 1}\)</span> such that <span class="math display">\[
\mathfrak{M}_{\rho}(\mathbf{r}, \mathbf{w}) \equiv \mathfrak{M}_{\varsigma}(\mathbf{r}, \mathbf{v}(\mathbf{r}, \mathbf{w}; \rho, \varsigma)),
\]</span> where <span class="math inline">\(\mathfrak{M}_{\rho}\)</span> is the generalized mean <span class="math display">\[
\mathfrak{M}_{\rho}(\mathbf{r}, \mathbf{w}) =
\begin{cases}
\left(\sum_{i = 1}^{n} w_{i} r_i^{\rho}\right)^{1 / \rho} &amp; \text{if } \rho \neq 0 \\
\prod_{i = 1}^{n} r_{i}^{w_{i}} &amp; \text{if } \rho = 0.
\end{cases}
\]</span></p>
<p>Setting <span class="math inline">\(\varsigma = 1\)</span> then yields an additive decomposition for any index based on a generalized mean of order <span class="math inline">\(\rho\)</span>, such that <span class="math display">\[
\mathfrak{M}_{\rho}(\mathbf{r}, \mathbf{w}) = \sum_{i=1}^{n} r_{i} v_i(\mathbf{r}, \mathbf{w}; \rho, 1),
\]</span> and setting <span class="math inline">\(\varsigma = 0\)</span> yields a multiplicative decomposition, such that <span class="math display">\[
\mathfrak{M}_{\rho}(\mathbf{r}, \mathbf{w}) = \prod_{i=1}^{n} r_{i}^{ v_i(\mathbf{r}, \mathbf{w}; \rho, 0)}.
\]</span> Note that any index that admits an additive decomposition can be used to derive percent-change contributions for each price relative, <span class="math inline">\(v_i(\mathbf{r}, \mathbf{w}; \rho, 1) (r_i - 1)\)</span>, that sum up to <span class="math inline">\(\mathfrak{M}_{\rho}(\mathbf{r}, \mathbf{w}) - 1\)</span>, although the converse is not true and it is possible to decompose an index into percent-change contributions that do not allow it to be represented as an arithmetic mean. Note also that other types of decompositions can be had by setting <span class="math inline">\(\varsigma\)</span> to a value other than 0 or 1; for example, setting <span class="math inline">\(\varsigma = -1\)</span> gives the harmonic decomposition,</p>
<p><span class="math display">\[
\mathfrak{M}_{\rho}(\mathbf{r}, \mathbf{w}) = 1 / \left(\sum_{i=1}^{n} v_i(\mathbf{r}, \mathbf{w}; \rho, -1) / r_{i}\right),
\]</span></p>
<p>that will be useful in <a href="#sec-harmonic" class="quarto-xref">Section 2.3</a>.</p>
<p><span class="citation" data-cites="balk2008">Balk (<a href="#ref-balk2008" role="doc-biblioref">2008</a>)</span> and <span class="citation" data-cites="reinsdorf2002">Reinsdorf, Diewert, and Ehemann (<a href="#ref-reinsdorf2002" role="doc-biblioref">2002</a>)</span> show how to derive <span class="math inline">\(\mathbf{v}(\mathbf{r}, \mathbf{w}; \rho, \varsigma)\)</span> when <span class="math inline">\(\rho = 1\)</span> and <span class="math inline">\(\varsigma = 0\)</span> (multiplicative decomposition of an arithmetic index) <span class="math display">\[
v_{i}(\mathbf{r}, \mathbf{w}; 1, 0) = \frac{w_{i} \mathfrak{L}(r_{i}, \mathfrak{M}_{1}(\mathbf{r}, \mathbf{w}))}{\sum_{j=1}^{n} w_{j} \mathfrak{L}(r_{j}, \mathfrak{M}_{1}(\mathbf{r}, \mathbf{w}))}
\]</span> and <span class="math inline">\(\rho = 0\)</span> and <span class="math inline">\(\varsigma = 1\)</span> (additive decomposition of a geometric index) <span class="math display">\[
v_{i}(\mathbf{r}, \mathbf{w}; 0, 1) = \frac{w_{i} / \mathfrak{L}(r_{i}, \mathfrak{M}_{0}(\mathbf{r}, \mathbf{w}))}{\sum_{j=1}^{n} w_{j} / \mathfrak{L}(r_{j}, \mathfrak{M}_{0}(\mathbf{r}, \mathbf{w}))},
\]</span> using the logarithmic mean <span class="math display">\[
\mathfrak{L}(a, b) =
\begin{cases}
\frac{a - b}{\log(a / b)} &amp; a \neq b\\
a &amp; a = b.
\end{cases}
\]</span></p>
<p>Generalizing these results follows from replacing the logarithmic mean with the more general extended mean <span class="citation" data-cites="bullen2003">(<a href="#ref-bullen2003" role="doc-biblioref">Bullen 2003, 393</a>)</span>, defined for any <span class="math inline">\(a,b &gt; 0\)</span> as <span class="math display">\[
\mathfrak{E}_{\rho\varsigma}(a, b) =
\begin{cases}
\left(\frac{\varsigma(a^\rho - b^\rho)}{\rho(a^\varsigma - b^\varsigma)}\right)^{1 / (\rho - \varsigma)} &amp; \rho \neq \varsigma, \rho \neq 0, \varsigma \neq 0, a \neq b \\
\left(\frac{a^\rho - b^\rho}{\rho\log(a / b)}\right)^{1 / \rho} &amp; \rho \neq 0, \varsigma = 0, a \neq b \\
\left(\frac{a^\varsigma - b^\varsigma}{\varsigma\log(a / b)}\right)^{1 / \varsigma} &amp; \rho = 0, \varsigma \neq 0, a \neq b \\
\frac{1}{\exp(1 / \rho)} \left(\frac{a^{a^\rho}}{b^{b^\rho}}\right)^{1 / (a^\rho - b^\rho)} &amp; \rho = \varsigma  \neq 0, a \neq b \\
\sqrt{ab} &amp; \rho = \varsigma = 0, a \neq b \\
a &amp; a = b.
\end{cases}
\]</span> The extended mean reduces to the logarithmic mean when either <span class="math inline">\(\rho = 0\)</span> and <span class="math inline">\(\varsigma = 1\)</span>, or <span class="math inline">\(\rho = 1\)</span> and <span class="math inline">\(\varsigma = 0\)</span>. But using the extended mean in place of the logarithmic mean allows for decompositions of indexes based on other types of means, like harmonic indexes (<span class="math inline">\(\rho = -1\)</span>) and the Lloyd-Moulton index (<span class="math inline">\(\rho = 1 - \sigma\)</span>, where <span class="math inline">\(\sigma\)</span> is an elasticity of substitution).</p>
<p>The key to transforming the weights in a generalized mean of order <span class="math inline">\(\rho\)</span> into the weights for a generalized mean of order <span class="math inline">\(\varsigma\)</span> comes from noting that the extended mean is always strictly positive and satisfies the identity <span id="eq-identity"><span class="math display">\[
\sum_{i=1}^{n} w_{i} \mathfrak{E}_{\rho\varsigma}(r_i, \mathfrak{M}_{\rho} (\mathbf{r}, \mathbf{w}))^{\rho - \varsigma} \varepsilon_{i}(\mathbf{r}, \mathbf{w}; \rho, \varsigma) \equiv 0,
\tag{1}\]</span></span> where <span class="math display">\[
\varepsilon_{i}(\mathbf{r}, \mathbf{w}; \rho, \varsigma) =
\begin{cases}
r_i^\varsigma - \mathfrak{M}_{\rho}(\mathbf{r}, \mathbf{w})^\varsigma &amp; \text{if } \varsigma \neq 0, \\
\log(r_i) - \log(\mathfrak{M}_{\rho}(\mathbf{r}, \mathbf{w})) &amp; \text{if } \varsigma = 0.
\end{cases}
\]</span> <a href="#eq-identity" class="quarto-xref">Equation 1</a> uses the extended mean to keep the weighted deviation from the mean constant for each price relative (up to a common factor of proportionality) when changing the order of the mean from <span class="math inline">\(\rho\)</span> to <span class="math inline">\(\varsigma\)</span>, without changing the value of the mean. Rearranging then gives that <span id="eq-res1"><span class="math display">\[
v_{i}(\mathbf{r}, \mathbf{w}; \rho, \varsigma) =  w_{i} \mathfrak{E}_{\rho\varsigma}(r_i, \mathfrak{M}_{\rho} (\mathbf{r}, \mathbf{w}))^{\rho - \varsigma} \Bigg/ \sum_{j=1}^{n} w_{j} \mathfrak{E}_{\rho\varsigma}(r_j, \mathfrak{M}_{\rho} (\mathbf{r}, \mathbf{w}))^{\rho - \varsigma}
\tag{2}\]</span></span> is a suitable function to find weights that turn an index based on a generalized mean of order <span class="math inline">\(\rho\)</span> into one based on a generalized mean of order <span class="math inline">\(\varsigma\)</span>.</p>
<p>The function given by <a href="#eq-res1" class="quarto-xref">Equation 2</a> takes on all existing decompositions that I know of as special cases. Setting <span class="math inline">\(\rho = 0\)</span> and <span class="math inline">\(\varsigma = 1\)</span>, or <span class="math inline">\(\rho = 1\)</span> and <span class="math inline">\(\varsigma = 0\)</span>, gives the special cases by <span class="citation" data-cites="balk2008">Balk (<a href="#ref-balk2008" role="doc-biblioref">2008</a>)</span> and <span class="citation" data-cites="reinsdorf2002">Reinsdorf, Diewert, and Ehemann (<a href="#ref-reinsdorf2002" role="doc-biblioref">2002</a>)</span> for decomposing indexes based on arithmetic and geometric means (because the extended mean reduces to the logarithmic mean). Similarly, because <span class="math inline">\(\mathfrak{E}_{\rho\varsigma}(r_i, \mathfrak{M}_{\rho} (\mathbf{r}, \mathbf{w}))^{\rho - \varsigma} \equiv \left(\mathfrak{M}_{\rho} (\mathbf{r}, \mathbf{w}) r_{i}\right)^\rho\)</span> when <span class="math inline">\(\rho = -1\)</span> and <span class="math inline">\(\varsigma = 1\)</span>, or <span class="math inline">\(\rho = 1\)</span> and <span class="math inline">\(\varsigma = -1\)</span>, setting <span class="math inline">\(\rho = -1\)</span> and <span class="math inline">\(\varsigma = 1\)</span> reduces <a href="#eq-res1" class="quarto-xref">Equation 2</a> to <span class="math display">\[
v_{i}(\mathbf{r}, \mathbf{w}; -1, 1) = \frac{w_{i} / r_{i}}{\sum_{i=1}^{n}w_{i} / r_{i}} ;
\]</span> if <span class="math inline">\(\mathbf{w}\)</span> is a vector of current-period expenditure/revenue shares then these are the hybrid weights that allow a Paasche index to be calculated as an arithmetic mean of price relatives. Setting <span class="math inline">\(\rho = 1\)</span> and <span class="math inline">\(\varsigma = -1\)</span> reduces <a href="#eq-res1" class="quarto-xref">Equation 2</a> to <span class="math display">\[
v_{i}(\mathbf{r}, \mathbf{w}; 1, -1) = \frac{w_{i} r_{i}}{\sum_{i=1}^{n}w_{i} r_{i}}.
\]</span> If <span class="math inline">\(\mathbf{w}\)</span> is a vector of base-period expenditure/revenue shares then these are the hybrid weights that allow a Laspeyres index to be calculated as a harmonic mean of price relatives. As should be expected, the weights are unchanged if <span class="math inline">\(\rho = \varsigma\)</span> or each element of <span class="math inline">\(\mathbf{r}\)</span> takes on the same value.</p>
<section class="level3"><h3 id="transitivity-monotonicity-and-uniqueness">Transitivity, monotonicity, and uniqueness<a class="anchor" aria-label="anchor" href="#transitivity-monotonicity-and-uniqueness"></a>
</h3>
<p>The extended mean has two properties that make it useful for decomposing price indexes. First, the order of the extended mean has a transitivity property under multiplication: <span class="math inline">\(\mathfrak{E}_{\rho\varsigma}(a, b)^{\rho - \varsigma} = \mathfrak{E}_{\rho\tau}(a, b)^{\rho - \tau}\mathfrak{E}_{\tau\varsigma}(a, b)^{\tau - \varsigma}\)</span>. This means the function in <a href="#eq-res1" class="quarto-xref">Equation 2</a> is transitivity, such that transmuting the weights to turn a generalized mean of order <span class="math inline">\(\rho\)</span> into a generalized mean of order <span class="math inline">\(\tau\)</span>, and then transmuting these weights again to turn a generalized mean of order <span class="math inline">\(\tau\)</span> into a generalized mean of order <span class="math inline">\(\varsigma\)</span>, is the same as finding weights to make a generalized mean of order <span class="math inline">\(\rho\)</span> into one of <span class="math inline">\(\varsigma\)</span>. That is, <span class="math display">\[
\mathbf{v}(\mathbf{r}, \mathbf{v}(\mathbf{r}, \mathbf{w}; \rho, \tau); \tau, \varsigma) \equiv \mathbf{v}(\mathbf{r}, \mathbf{w}; \rho, \varsigma).
\]</span> As will be seen later, not all decompositions have this property.</p>
<p>Second, the extended mean is a strictly increasing function in both arguments <span class="citation" data-cites="bullen2003">(<a href="#ref-bullen2003" role="doc-biblioref">Bullen 2003, 395</a>)</span>. This means that the function in <a href="#eq-res1" class="quarto-xref">Equation 2</a> has a monotonicity property where the transmuted weights increase (decrease) for large (small) price relatives if and only if <span class="math inline">\(\rho &gt; \varsigma\)</span>. That is, assuming <span class="math inline">\(\mathbf{r}\)</span> is ordered from smallest to largest (and does not contain all the same value), if <span class="math inline">\(\rho &gt; \varsigma\)</span> then there is a pair of integer <span class="math inline">\(k,l\)</span>, with <span class="math inline">\(k\leq l\)</span>, such that <span class="math inline">\(v_{i}(\mathbf{r}, \mathbf{w}; \rho, \varsigma) &gt; w_{i}\)</span> for <span class="math inline">\(i\geq l\)</span> and <span class="math inline">\(v_{i}(\mathbf{r}, \mathbf{w}; \rho, \varsigma) &lt; w_{i}\)</span> for <span class="math inline">\(i\leq k\)</span>, with these equalities reversed if <span class="math inline">\(\rho &lt; \varsigma\)</span>. Again, not all decompositions satisfy this property.</p>
<p>The decomposition given by <a href="#eq-res1" class="quarto-xref">Equation 2</a> is unique when <span class="math inline">\(n = 2\)</span> and <span class="math inline">\(r_{1} \neq r_{2}\)</span>, and is the only such function that always returns <span class="math inline">\(\mathbf{w}\)</span> when <span class="math inline">\(r_{1} = r_{2}\)</span>. But <a href="#eq-res1" class="quarto-xref">Equation 2</a> is necessarily not unique when <span class="math inline">\(n\geq3\)</span>, and there are infinitely many ways to decompose an index based on the generalized mean.<a class="footnote-ref" role="doc-noteref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Take, for example, (1/2, 1, 3/2) with weights (1/6, 1/3, 1/2). The weighted harmonic mean of is 1, which can be computed as an arithmetic mean with weights (1/3, 1/3, 1/3) or (1/4, 1/2, 1/4). Hence there are multiple additive decompositions for the harmonic mean.&lt;/p&gt;"><sup>2</sup></a> Nonetheless, the limited case of uniqueness will be useful in <a href="#sec-superlative" class="quarto-xref">Section 2.1</a>.</p>
</section><section class="level3"><h3 id="numerical-example">Numerical example<a class="anchor" aria-label="anchor" href="#numerical-example"></a>
</h3>
<p>Consider the following numerical example of decomposing a quadratic-mean index <span class="citation" data-cites="vonderlippe2007">(<a href="#ref-vonderlippe2007" role="doc-biblioref">Lippe 2007, 61</a>)</span> (i.e., a producer price index with an elasticity of substitution of -1) made using the price and quantity data from <span class="citation" data-cites="balk2008">Balk (<a href="#ref-balk2008" role="doc-biblioref">2008</a>, tables 3.1 and 3.2)</span>. The <code><a href="../reference/transmute_weights.html">transmute_weights()</a></code> function factory parameterizes the decomposition in <a href="#eq-res1" class="quarto-xref">Equation 2</a> to make a function that decomposes any generalized-mean index.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marberts.github.io/gpindex/">gpindex</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">price6</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">price6</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">q2</span> <span class="op">&lt;-</span> <span class="va">quantity6</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">q1</span> <span class="op">&lt;-</span> <span class="va">quantity6</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">rel</span> <span class="op">&lt;-</span> <span class="va">p2</span> <span class="op">/</span> <span class="va">p1</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale_weights.html">scale_weights</a></span><span class="op">(</span><span class="va">p1</span> <span class="op">*</span> <span class="va">q1</span><span class="op">)</span></span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale_weights.html">scale_weights</a></span><span class="op">(</span><span class="va">p2</span> <span class="op">*</span> <span class="va">q2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">quadratic_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generalized_mean.html">generalized_mean</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">quadratic_decomposition</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transmute_weights.html">transmute_weights</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu">quadratic_decomposition</span><span class="op">(</span><span class="va">rel</span>, <span class="va">s1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="fu">quadratic_mean</span><span class="op">(</span><span class="va">rel</span>, <span class="va">s1</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/generalized_mean.html">arithmetic_mean</a></span><span class="op">(</span><span class="va">rel</span>, <span class="va">v</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>Because the quadratic mean is larger than the arithmetic mean, the weight from the smaller price relatives is transferred to the largest price relative.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">v</span> <span class="op">-</span> <span class="va">s1</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">rel</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] -0.024395704 -0.010503706 -0.007454243 -0.008131901 -0.003049463</span></span>
<span><span class="co">#&gt; [6]  0.053535017</span></span></code></pre></div>
</div>
<p>It is also readily seen that turning the arithmetic decomposition into a geometric one is the same as directly constructing the multiplicative decomposition.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/transmute_weights.html">transmute_weights</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">(</span><span class="va">rel</span>, <span class="va">v</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/transmute_weights.html">transmute_weights</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span><span class="op">(</span><span class="va">rel</span>, <span class="va">s1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</section></section><section class="level2"><h2 id="extensions">Extensions<a class="anchor" aria-label="anchor" href="#extensions"></a>
</h2>
<section class="level3"><h3 id="sec-superlative">Decomposing superlative indexes<a class="anchor" aria-label="anchor" href="#sec-superlative"></a>
</h3>
<p>The additive and multiplicative decompositions for the Fisher index by <span class="citation" data-cites="reinsdorf2002">Reinsdorf, Diewert, and Ehemann (<a href="#ref-reinsdorf2002" role="doc-biblioref">2002, sec. 6</a>)</span> can be generalized in the same way as the decompositions for the arithmetic and geometric indexes by noting that the Fisher index is simply a nested generalized mean of indexes based on the generalized mean. For a pair of generalized means <span class="math inline">\(\mathfrak{N}_{\rho_{1}\rho_{2}}(\mathbf{r}, \mathbf{w}_{1}, \mathbf{w}_{2})=\left(\mathfrak{M}_{\rho_1}(\mathbf{r}, \mathbf{w}_1), \mathfrak{M}_{\rho_2}(\mathbf{r}, \mathbf{w}_2)\right)\)</span> mapping into <span class="math inline">\(R_2^{++}\)</span> with weights <span class="math inline">\(\mathbf{\omega}=(\omega_1, \omega_2) \in \Delta^1\)</span>, an index based on nested generalized means is written as <span id="eq-superlative"><span class="math display">\[
\mathfrak{M}_{\rho}\left(\mathfrak{N}_{\rho_{1}\rho_{2}}(\mathbf{r}, \mathbf{w}_{1}, \mathbf{w}_{2}), \mathbf{\omega}\right).
\tag{3}\]</span></span></p>
<p>The general family of superlative quadratic mean indexes of order <span class="math inline">\(\tau\)</span> comes from setting <span class="math inline">\(\rho = 0\)</span>, <span class="math inline">\(\rho_1 = \tau / 2\)</span>, and <span class="math inline">\(\rho_2 = -\tau / 2\)</span> when <span class="math inline">\(\omega_1 = \omega_2 = 1 / 2\)</span>, <span class="math inline">\(\mathbf{w}_1\)</span> are base-period expenditure/revenue shares, and <span class="math inline">\(\mathbf{w}_2\)</span> are current-period expenditure/revenue shares. In particular, setting <span class="math inline">\(\tau = 2\)</span> gives the Fisher index and setting <span class="math inline">\(\tau = 1\)</span> gives the implicit Walsh index. But <a href="#eq-superlative" class="quarto-xref">Equation 3</a> covers other types of indexes as well; for example, setting each element of <span class="math inline">\(\mathbf{w}_1\)</span> and <span class="math inline">\(\mathbf{w}_2\)</span> to <span class="math inline">\(1 / n\)</span> when <span class="math inline">\(\tau = 2\)</span> gives the Carruthers-Sellwood-Ward-Dalén index that serves as an estimator for the Fisher index, whereas <span class="math inline">\(\tau = 1\)</span> gives the Balk-Walsh index. Setting <span class="math inline">\(\rho = -1\)</span> gives the harmonic analogue of the Fisher index, which is not a superlative quadratic mean indexes of order <span class="math inline">\(\tau\)</span>. Finally, setting <span class="math inline">\(\rho = \rho_{1} = \rho_{2}\)</span> and <span class="math inline">\(\mathbf{w}_{1} = \mathbf{w}_{2}\)</span> gives an index based on a generalized mean of order <span class="math inline">\(\rho\)</span>, so that the decomposition of an index based on the generalized mean is a special case of the decomposition for <a href="#eq-superlative" class="quarto-xref">Equation 3</a>.</p>
<p>An index of form <a href="#eq-superlative" class="quarto-xref">Equation 3</a> can be decomposed into an index based on the generalized mean of order <span class="math inline">\(\rho\)</span> using the weights in <a href="#eq-res1" class="quarto-xref">Equation 2</a>, as it can be written as the generalized mean <span class="math display">\[
\mathfrak{M}_{\rho}(\mathbf{r}, \omega_1 \mathbf{v}(\mathbf{r}, \mathbf{w}_1; \rho_1, \rho) + \omega_2\mathbf{v}(\mathbf{r}, \mathbf{w}_2; \rho_2, \rho)).
\]</span> The transformation in <a href="#eq-res1" class="quarto-xref">Equation 2</a> then applies as before, just replacing <span class="math inline">\(\mathbf{w}\)</span> with the more complicated weights <span class="math inline">\(\omega_1 \mathbf{v}(\mathbf{r}, \mathbf{w}_1; \rho_1, \rho) + \omega_2\mathbf{v}(\mathbf{r}, \mathbf{w}_2, \rho_2, \rho)\)</span>, which can be written as <span id="eq-res2"><span class="math display">\[
\mathbf{v}(\mathbf{r}, \omega_1 \mathbf{v}(\mathbf{r}, \mathbf{w}_1; \rho_1, \rho) + \omega_2\mathbf{v}(\mathbf{r}, \mathbf{w}_2; \rho_2, \rho); \rho, \varsigma).
\tag{4}\]</span></span> The idea is to transmute the weights for both inner means to be of the same order as the outer mean (<span class="math inline">\(\rho\)</span>) so that they can be added together, and then transmute these weights to represent the outer generalized mean as a mean of order <span class="math inline">\(\varsigma\)</span>. Note that this means the decomposition satisfies the same transitivity property as <a href="#eq-res1" class="quarto-xref">Equation 2</a> with respect to <span class="math inline">\(\rho\)</span> and <span class="math inline">\(\varsigma\)</span>.</p>
<p>Continuing with the previous example, the <code><a href="../reference/transmute_weights.html">nested_transmute()</a></code> factory parameterizes the decomposition in <a href="#eq-res2" class="quarto-xref">Equation 4</a> and can be used to decompose the Fisher index.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transmute_weights.html">nested_transmute</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">(</span><span class="va">rel</span>, <span class="va">s1</span>, <span class="va">s2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="../reference/nested_mean.html">fisher_mean</a></span><span class="op">(</span><span class="va">rel</span>, <span class="va">s1</span>, <span class="va">s2</span><span class="op">)</span>, <span class="fu"><a href="../reference/generalized_mean.html">arithmetic_mean</a></span><span class="op">(</span><span class="va">rel</span>, <span class="va">v1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">v1</span>,</span>
<span>  <span class="fu">quadratic_decomposition</span><span class="op">(</span><span class="va">rel</span>, <span class="fu"><a href="../reference/transmute_weights.html">nested_transmute</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">(</span><span class="va">rel</span>, <span class="va">s1</span>, <span class="va">s2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>An alternative approach to decompose <a href="#eq-superlative" class="quarto-xref">Equation 3</a> is to generalize the (additive) van IJzeren decomposition for the Fisher index, which can be written as <span id="eq-res3"><span class="math display">\[
v_{1}(\mathfrak{N}_{\rho_{1}\rho_{2}}(\mathbf{r}, \mathbf{w}_{1}, \mathbf{w}_{2}), \mathbf{\omega}; \rho, \varsigma) \mathbf{v}(\mathbf{r}, \mathbf{w}_1; \rho_1, \varsigma) + v_{2}(\mathfrak{N}_{\rho_{1}\rho_{2}}(\mathbf{r}, \mathbf{w}_{1}, \mathbf{w}_{2}), \mathbf{\omega}; \rho, \varsigma) \mathbf{v}(\mathbf{r}, \mathbf{w}_2; \rho_2, \varsigma).
\tag{5}\]</span></span> Note that for a Fisher index, if <span class="math inline">\(\varsigma=1\)</span> then <span class="math inline">\(\mathbf{v}(\mathbf{r}, \mathbf{w}_1; \rho_1, \varsigma)\)</span> is a vector of base-period expenditure/revenue shares, <span class="math inline">\(\mathbf{v}(\mathbf{r}, \mathbf{w}_2; \rho_2, \varsigma)\)</span> is a vector of hybrid Paasche weights, and <span class="math inline">\(\mathbf{v}(\mathfrak{N}_{\rho_{1}\rho_{2}}(\mathbf{r}, \mathbf{w}_{1}, \mathbf{w}_{2}), \mathbf{\omega}; \rho, \varsigma)\)</span> are the unique weights that decompose the geometric mean of the Laspeyres and Paasche indexes, which equals the van IJzeren decomposition. The idea here is to transmute the weights for both the inner and outer generalized means so that they are means of order <span class="math inline">\(\varsigma\)</span>, then take the product of these weights. <a href="#eq-res2" class="quarto-xref">Equation 4</a> and <a href="#eq-res3" class="quarto-xref">Equation 5</a> generally give different decompositions, as the latter is not transitive, but reduce to <a href="#eq-res1" class="quarto-xref">Equation 2</a> when <span class="math inline">\(\rho = \rho_{1} = \rho_{2}\)</span> and <span class="math inline">\(\mathbf{w}_{1} = \mathbf{w}_{2}\)</span>. The <code><a href="../reference/transmute_weights.html">nested_transmute2()</a></code> function implements this method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transmute_weights.html">nested_transmute2</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">(</span><span class="va">rel</span>, <span class="va">s1</span>, <span class="va">s2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="../reference/nested_mean.html">fisher_mean</a></span><span class="op">(</span><span class="va">rel</span>, <span class="va">s1</span>, <span class="va">s2</span><span class="op">)</span>, <span class="fu"><a href="../reference/generalized_mean.html">arithmetic_mean</a></span><span class="op">(</span><span class="va">rel</span>, <span class="va">v2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">v2</span>,</span>
<span>  <span class="fu">quadratic_decomposition</span><span class="op">(</span><span class="va">rel</span>, <span class="fu"><a href="../reference/transmute_weights.html">nested_transmute2</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">(</span><span class="va">rel</span>, <span class="va">s1</span>, <span class="va">s2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Mean relative difference: 7.760085e-05"</span></span></code></pre></div>
</div>
<p>Overall the difference between the two approaches tends to be small.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">v1</span> <span class="op">-</span> <span class="va">v2</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Min.    1st Qu.     Median       Mean    3rd Qu.       Max. </span></span>
<span><span class="co">#&gt; -7.726e-06 -3.059e-06  1.977e-07  0.000e+00  2.617e-06  8.052e-06</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="decomposing-aggregated-indexes">Decomposing aggregated indexes<a class="anchor" aria-label="anchor" href="#decomposing-aggregated-indexes"></a>
</h3>
<p>The decomposition in <a href="#eq-res3" class="quarto-xref">Equation 5</a> can be extended to get a decomposition for an index constructed using the usual two-step procedure to make a price index. If price relatives are partitioned into <span class="math inline">\(k\)</span> groups, and an index is made from <span class="math inline">\(k\)</span> sub-indexes <span class="math inline">\(\mathfrak{N}_{\rho_{1}\ldots\rho_{k}}(\mathbf{r}, \mathbf{w}_{1}, \ldots, \mathbf{w}_{k}) = \left(\mathfrak{M}_{\rho_1}(\mathbf{r}_{1}, \mathbf{w}_{1}), \ldots, \mathfrak{M}_{\rho_k}(\mathbf{r}_{k}, \mathbf{w}_{k})\right)\)</span> with weights <span class="math inline">\(\mathbf{\omega}=(\omega_{1},\ldots,\omega_{k})\)</span> as a generalized mean of order <span class="math inline">\(\rho\)</span>, then</p>
<p><span class="math display">\[
v_{i}(\mathfrak{N}_{\rho_{1}\ldots\rho_{k}}(\mathbf{r}, \mathbf{w}_{1}, \ldots, \mathbf{w}_{k}), \mathbf{\omega}; \rho, \varsigma) \mathbf{v}(\mathbf{r}_{i}, \mathbf{w}_i; \rho_1, \varsigma)
\]</span></p>
<p>decomposes how the components of the <span class="math inline">\(i\)</span>-th sub-index contribute towards the total index. Concatenating each of these vectors of weights along with the vector of price relatives represents the nested mean over the partitioning of price relatives as a generalized mean of order <span class="math inline">\(\varsigma\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1_by_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">s1</span>, <span class="va">group</span><span class="op">)</span></span>
<span><span class="va">rel_by_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">rel</span>, <span class="va">group</span><span class="op">)</span></span>
<span></span>
<span><span class="va">index_a</span> <span class="op">&lt;-</span> <span class="fu">quadratic_mean</span><span class="op">(</span><span class="va">rel_by_group</span><span class="op">$</span><span class="va">a</span>, <span class="va">s1_by_group</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="va">index_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generalized_mean.html">geometric_mean</a></span><span class="op">(</span><span class="va">rel_by_group</span><span class="op">$</span><span class="va">b</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">quadratic_mean</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">index_a</span>, <span class="va">index_b</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">s1_by_group</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.375553</span></span>
<span></span>
<span><span class="va">decomp_a</span> <span class="op">&lt;-</span> <span class="fu">quadratic_decomposition</span><span class="op">(</span><span class="va">rel_by_group</span><span class="op">$</span><span class="va">a</span>, <span class="va">s1_by_group</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="va">decomp_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transmute_weights.html">transmute_weights</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">(</span><span class="va">rel_by_group</span><span class="op">$</span><span class="va">b</span><span class="op">)</span></span>
<span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span></span>
<span>  <span class="va">`*`</span>,</span>
<span>  <span class="fu">quadratic_decomposition</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">index_a</span>, <span class="va">index_b</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">s1_by_group</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">decomp_a</span>, <span class="va">decomp_b</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/generalized_mean.html">arithmetic_mean</a></span><span class="op">(</span><span class="va">rel</span>, <span class="va">v</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.375553</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="sec-harmonic">Decomposing deflators<a class="anchor" aria-label="anchor" href="#sec-harmonic"></a>
</h3>
<p>The decomposition in <a href="#eq-res1" class="quarto-xref">Equation 2</a> can be used to construct a decomposition for how a price index deflates a change in aggregate value over time to get a quantity index. Letting <span class="math inline">\(V\)</span> be the change in total value between two periods, the implicit quantity index for a price index based on the generalized mean of order <span class="math inline">\(\rho\)</span> is</p>
<p><span class="math display">\[
\frac{V}{\mathfrak{M}_{\rho}(\mathbf{r}, \mathbf{w})}.
\]</span></p>
<p>Using <a href="#eq-res1" class="quarto-xref">Equation 2</a> to find weights to represent <span class="math inline">\(\mathfrak{M}_{\rho}(\mathbf{r}, \mathbf{w})\)</span> as a harmonic mean means that</p>
<p><span id="eq-res4"><span class="math display">\[
V/ \mathfrak{M}_{\rho}(\mathbf{r}, \mathbf{w}) \equiv \mathfrak{M}_{\varsigma}(V / \mathbf{r}, \mathbf{v}(\mathbf{r}, \mathbf{w}; \rho, -\varsigma)).
\tag{6}\]</span></span></p>
<p>Setting <span class="math inline">\(\varsigma=1\)</span> then gives an additive decomposition for how each price relative acts to deflate the change in total value over time, while setting <span class="math inline">\(\varsigma=0\)</span> gives a multiplicative decomposition. The same holds true when deflating with an index based on nested means, using either <a href="#eq-res2" class="quarto-xref">Equation 4</a> or <a href="#eq-res3" class="quarto-xref">Equation 5</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">V</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">p2</span> <span class="op">*</span> <span class="va">q2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">p1</span> <span class="op">*</span> <span class="va">q1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transmute_weights.html">nested_transmute2</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">(</span><span class="va">rel</span>, <span class="va">s1</span>, <span class="va">s2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/generalized_mean.html">arithmetic_mean</a></span><span class="op">(</span><span class="va">V</span> <span class="op">/</span> <span class="va">rel</span>, <span class="va">v</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/nested_mean.html">fisher_mean</a></span><span class="op">(</span><span class="va">q2</span> <span class="op">/</span> <span class="va">q1</span>, <span class="va">s1</span>, <span class="va">s2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">V</span> <span class="op">/</span> <span class="va">rel</span> <span class="op">*</span> <span class="va">v</span></span>
<span><span class="co">#&gt; [1] 0.08971270 0.09467911 0.19432463 0.11454476 0.45833768 0.05478917</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="decomposing-contra-harmonic-indexes">Decomposing contra-harmonic indexes<a class="anchor" aria-label="anchor" href="#decomposing-contra-harmonic-indexes"></a>
</h3>
<p><span class="citation" data-cites="vonderlippe2015">von der Lippe (<a href="#ref-vonderlippe2015" role="doc-biblioref">2015</a>)</span> discusses using the contra-harmonic mean (or antiharmonic as he calls it), a special case of the Lehmer mean <span class="citation" data-cites="bullen2003">(<a href="#ref-bullen2003" role="doc-biblioref">Bullen 2003, 245</a>)</span> (of order 2), to make price indexes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Arithmetic hybrid index</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/generalized_mean.html">arithmetic_mean</a></span><span class="op">(</span><span class="va">p2</span> <span class="op">/</span> <span class="va">p1</span>, <span class="va">p2</span> <span class="op">*</span> <span class="va">q1</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/lehmer_mean.html">contraharmonic_mean</a></span><span class="op">(</span><span class="va">p2</span> <span class="op">/</span> <span class="va">p1</span>, <span class="va">p1</span> <span class="op">*</span> <span class="va">q1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># Palgrave index</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/generalized_mean.html">arithmetic_mean</a></span><span class="op">(</span><span class="va">p2</span> <span class="op">/</span> <span class="va">p1</span>, <span class="va">p2</span> <span class="op">*</span> <span class="va">q2</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/lehmer_mean.html">contraharmonic_mean</a></span><span class="op">(</span><span class="va">p2</span> <span class="op">/</span> <span class="va">p1</span>, <span class="va">p1</span> <span class="op">*</span> <span class="va">q2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>The Lehmer mean of order <span class="math inline">\(\rho\)</span> is simply the arithmetic mean of the with weights</p>
<p><span class="math display">\[
\left(w_{1}r_{1}^{\rho - 1}, \ldots, w_{n}r_{n}^{\rho - 1}\right) / \sum_{i = 1}^{n} w_{i} r_{i}^{\rho - 1},
\]</span></p>
<p>and so indexes based on these means can be decomposed with <a href="#eq-res1" class="quarto-xref">Equation 2</a> by using the these weights instead of <span class="math inline">\(\mathbf{w}\)</span>.</p>
</section></section><section class="level2 unnumbered"><h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-balk2008" class="csl-entry" role="listitem">
Balk, B. M. 2008. <em>Price and Quantity Index Numbers</em>. Cambridge University Press.
</div>
<div id="ref-bullen2003" class="csl-entry" role="listitem">
Bullen, P. S. 2003. <em>Handbook of Means and Their Inequalities</em>. Springer Science+Business Media.
</div>
<div id="ref-diewert2002" class="csl-entry" role="listitem">
Diewert, W. E. 2002. <span>“The Quadratic Approximation Lemma and Decompositions of Superlative Indexes.”</span> <em>Journal of Economic and Social Measurement</em> 28 (1-2): 63–88.
</div>
<div id="ref-hallerbach2005" class="csl-entry" role="listitem">
Hallerbach, W. G. 2005. <span>“An Alternative Decomposition of the <span>F</span>isher Index.”</span> <em>Economics Letters</em> 86 (2): 147–52.
</div>
<div id="ref-lent2009" class="csl-entry" role="listitem">
Lent, J., and A. H. Dorfman. 2009. <span>“Using a Weighted Average of Base Period Price Indexes to Approximate a Superlative Index.”</span> <em>Journal of Official Statistics</em> 25 (1): 149–49.
</div>
<div id="ref-vonderlippe2007" class="csl-entry" role="listitem">
Lippe, Peter von der. 2007. <em>Index Theory and Price Statistics</em>. Peter Lang.
</div>
<div id="ref-martin2021" class="csl-entry" role="listitem">
Martin, S. 2021. <span>“A Note on Generalized Decompositions for Price Indexes.”</span> Statistics Canada.
</div>
<div id="ref-reinsdorf2002" class="csl-entry" role="listitem">
Reinsdorf, M. B., W. E. Diewert, and C. Ehemann. 2002. <span>“Additive Decompositions for <span>F</span>isher, <span>Tö</span>rnqvist and Geometric Mean Indexes.”</span> <em>Journal of Economic and Social Measurement</em> 28 (1-2): 51–61.
</div>
<div id="ref-vonderlippe2015" class="csl-entry" role="listitem">
von der Lippe, P. 2015. <span>“Generalized Statistical Means and New Price Index Formulas, Notes on Some Unexplored Index Formulas, Their Interpretations and Generalizations.”</span> Munich Personal RePEc Archive paper no. 64952.
</div>
<div id="ref-webster2019" class="csl-entry" role="listitem">
Webster, M. B., and R. C. Tarnow-Mordi. 2019. <span>“Decomposing Multilateral Price Indexes into the Contributions of Individual Commodities.”</span> <em>Journal of Official Statistics</em> 35: 461–86.
</div>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steve Martin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
